<!DOCTYPE html>
<html>
    <head>
        <title>{{title}}</title>
    </head>

    <body>
        <h1>Cluster ID: {{ cluster.id }}</h1>
        <h3>Family: {{ cluster.family }}</h3>
        <h3>Representative EMBL: {{ cluster.rep_EMBL }}</h3>
        <h3>Representative genome: {{ cluster.rep_genome }}</h3>

        <h2>Operon Structure</h2>
		<div id="all_operons_container"></div>


    </body>

    <style>

    #all_operons_container {
        border: 1px solid black;
        width: 90vw;
        margin: auto;
    }

    .operon_description{
        width: 19%;
        display: inline-block;
        text-align: center;
        font-size: 1.3rem;
        vertical-align: middle;
    }

    .operon_graphic{
        display: inline-block;
        width: 75%;
        margin-left: 5%;
    }

    .operonContainer{
	width: 90vw;
	padding-top: 3vh;
    display: inline-block;
}

.operon_scroll_container{
	width: 90vw;
	padding-top: 3vh;
    display: inline-block;
    height: 70vh;
    overflow-y: scroll;
    border-top: 1px solid black;
}

.spacer{
	display: block;
	height: 20vh;
}

.Rgene{
	height: 40px;
	display: inline-block;
	position: relative;
	z-index: 1;
}

.Rgene:before{
	content:"";
	position: absolute;
	right: 0;
	bottom: 0;
	width: 0;
	height: 0;
	border-left: var(--color);
	border-top: 20px solid white;
	border-bottom: 20px solid white;
	z-index: 2;
}

.Rgene .description {
	visibility: hidden;
	width: 9rem;
	text-align: center;
	padding: 5px 0;
	border: 1px solid black;
	border-radius: 3px;
	border-color: #225470;
	position: absolute;
	top: 250%;
	left:50%;
	transform: translate(-50%, -50%);
	z-index: 3;
	color: black;
}

.Rgene:hover .description {
	visibility: visible;
}

.Lgene {
	height: 40px;
	display: inline-block;
	position: relative;
	z-index:1;
}

.Lgene:after{
	content:"";
	position: absolute;
	left: 0;
	bottom: 0;
	width: 0;
	height: 0;
	border-right: var(--color);
	border-top: 20px solid white;
	border-bottom: 20px solid white;
	z-index: 2;
}

.Lgene .description {
	visibility: hidden;
	width: 9rem;
	text-align: center;
	padding: 5px 0;
	border: 1px solid black;
	border-radius: 3px;
	border-color: #225470;
	position: absolute;
	top: 250%;
	left:50%;
	transform: translate(-50%, -50%);
	z-index: 3;
	color: black;
}

.Lgene:hover .description {
	visibility: visible;
}

.line{
	background-color: black;
	height:2px;
	width: 75vw;
	position: absolute;
	margin-top: -25px;
}

</style>

<script>
	
	//since javascript doesn't have a built-in range function	
	function range(start, stop){
		var myList = [];
		for (let i = start; i <= (stop-1); i++){
			myList.push(i);
		}
		return myList;
	}


// Operon Javascript

    let all_operons = document.getElementById("all_operons_container");

    let template_container = document.createElement("div");
    template_container.classList.add("operonContainer");


    function renderOperon(operon) {

        let operon_container = document.createElement("div");
        let operon_graphic = document.createElement("div");
        operon_graphic.classList.add("operon_graphic");
        //let operon_description = document.createElement("div");
        //operon_description.classList.add("operon_description");
        //operon_description.innerText = "Accession: "+meta_data["accession"]+"\n\nPercent Identity: "+meta_data["identity"]+"\n\nOrganism: "+meta_data["organism"];
        let container = document.createElement("div");
        container.classList.add("operonContainer");

		for (i in operon){
            let link = document.createElement('a');
            if (operon[i]['link'].length !== 0){
                link.setAttribute("href", "https://ncbi.nlm.nih.gov/protein/"+operon[i]['link']); }
            link.setAttribute("target", "_blank");
            
            let gene = document.createElement('div');
            if (operon[i]["direction"] == "+"){
                gene.classList.add("Rgene");
            } else {
                gene.classList.add("Lgene");
            }

            gene.setAttribute("style", "background-color: "+operon[i]["color"]+
                "; width:"+operon[i]["length"]+
                "; margin-right:"+operon[i]["spacer"])
            
            gene.style.setProperty('--color', '20px solid '+operon[i]["color"]);
            
            description = document.createElement('span');
            description.innerText = operon[i]["description"];
            description.classList.add("description");
            gene.appendChild(description)
            link.appendChild(gene);

            operon_graphic.appendChild(link);
        }

	

    let spacer = document.createElement('span');
	spacer.classList.add("spacer");
	let line = document.createElement('hr');
	line.classList.add("line");

	//operon_container.appendChild(operon_description);
	operon_container.appendChild(operon_graphic);
	operon_container.appendChild(spacer);

    template_container.appendChild(operon_container);
    all_operons.appendChild(template_container);

    }

    var operon_data = {{ operon|safe }}
    
    renderOperon( operon_data );


</script>

</html>


